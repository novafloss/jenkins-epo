[tox]
envlist = py{34,35}-tests,py{src,34,35}-upload,lint

[testenv]
usedevelop = true
setenv =
    EPO_CACHE_PATH=.epo-test
commands =
    tests: pip --disable-pip-version-check install -e .[test]
    tests: py.test -vvvv --strict --showlocals --junit-xml={env:CIRCLE_TEST_REPORTS:.}/junit.xml --cov=jenkins_epo --cov-report=xml tests/
    pysrc-upload: python setup.py sdist upload -r pypi
    py{34,35}-upload: python setup.py bdist_wheel upload -r pypi

[testenv:lint]
basepython = python3.4
deps =
    flake8
    docutils
commands =
    flake8 --verbose jenkins_epo/ tests/
    rst2html.py --strict README.rst /dev/null
